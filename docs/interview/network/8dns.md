---
title: DNS域名解析
order: 8
group:
  order: 2
  title: 网络
  path: /interview/network
nav:
  order: 3
  title: 'interview'
  path: /interview
---

![DNS过程](https://pic1.zhimg.com/80/v2-c7ac39dd7f7de285137af05dd3d623e8_720w.webp)

前置，用户输入 url 之后有什么步骤

- 构建请求行：浏览器进程首先会构建请求行信息，然后通过进程间通信 IPC 将 URL 请求发送给网络进程。

- 查找缓存：网络进程获取到 URL 之后，会先去本地缓存中查找是否有缓存资源，如果有则直接将缓存资源返回给浏览器进程，否则进入网络请求阶段。

- DNS 解析：网络进程请求首先会从 DNS 数据缓存服务器中查找是否缓存过当前域名的信息，有则直接返回，否则，会进行 DNS 解析域名对应的 IP 和端口号。

- 等待 TCP 队列：chrome 有个机制，同一个域名同时最多只能建立 6 个 TCP 连接，如果超过这个数量的连接必须要进入排队等待状态。

- 建立 TCP 连接：通过 TCP 三次握手与服务器建立连接，然后进行数据传输。

- 发起 HTTP 请求：浏览器首先会向服务器发送请求行，请求行中包含了请求方法、请求 URI 和 HTTP 版本，还会发送请求头，告诉服务器一些浏览器的相关信息，比如浏览器内核、请求域名、Cookie 等信息。服务器处理请求：服务器首先返回相应行，包括协议版本和状态码，然后会返回响应头包含返回的数据类型，服务器要在客户端保存的 Cookie 等。

- 断开 TCP 连接：数据传输完成后，通过四次挥手来断开连接。

### 概念

DNS 是域名系统 (Domain Name System) 的缩写，提供的是一种**主机名到 IP 地址的转换服务**，就是我们常说的域名系统

作用： 将域名解析为 IP 地址，客户端向 DNS 服务器（DNS 服务器有自己的 IP 地址）发送域名查询请求，DNS 服务器告知客户机 Web 服务器的 IP 地址

浏览器访问了某个域名，首先会查找**浏览器缓存、本地 hosts 文件、DNS 缓存**，没有找到的话再去请求本地 DNS 服务器，由它负责完成域名的解析。

本地 DNS 会依次请求根域名服务器拿到对应的顶级域名服务器的地址，然后请求顶级域名服务器，拿到权威域名服务器的地址，之后权威域名服务器会返回最终的 IP 给本地 DNS 服务器，由它再返给浏览器。

比如说 http://baidu.com 这个域名，根域名是 **.**，顶级域名（也叫一级域名）是 com，而二级域名是 http://baidu.com，那会先向根域名服务器查找 com 的顶级域名服务器的地址，然后再向 com 的顶级域名服务器查找 http://baidu.com 的权威域名服务器的地址。

- 跟域名： .
- 一级域名(顶级域名)：com
- 二级域名：baidu.com

> 在域名系统（Domain Name System）中，根域名是最高级别的域名，它位于域名层次结构的最顶层。根域名用一个点表示（.），它不包含任何标识符或字符。根域名是域名系统的基础，它作为所有其他域名的起点。

> 如果你指的是权威域名服务器（Authoritative Name Server），那是指在域名系统中负责存储特定域名的 DNS 记录，并提供其他 DNS 服务器和客户端查询该域名的解析信息的服务器。当一个域名查询请求被发起时，本地 DNS 服务器会向权威域名服务器发送查询请求，以获取所请求域名的解析信息（如 IP 地址）。权威域名服务器是拥有该域名解析信息的最终来源，并提供权威回答。一旦权威域名服务器返回查询结果，本地 DNS 服务器将其缓存并返回给发起请求的客户端。

### DNS 同时使用 TCP 和 UDP 协议？

DNS 占用 53 号端口，同时使用 TCP 和 UDP 协议。（1）在区域传输的时候使用 TCP 协议 ● 辅域名服务器会定时（一般 3 小时）向主域名服务器进行查询以便了解数据是否有变动。如有变动，会执行一次区域传送，进行数据同步。区域传送使用 TCP 而不是 UDP，因为数据同步传送的数据量比一个请求应答的数据量要多得多。 ● TCP 是一种可靠连接，保证了数据的准确性。（2）在域名解析的时候使用 UDP 协议 ● 客户端向 DNS 服务器查询域名，一般返回的内容都不超过 512 字节，用 UDP 传输即可。不用经过三次握手，这样 DNS 服务器负载更低，响应更快。理论上说，客户端也可以指定向 DNS 服务器查询时用 TCP，但事实上，很多 DNS 服务器进行配置的时候，仅支持 UDP 查询包。

### DNS 完整的查询过程

DNS 服务器解析域名的过程： ● 首先会在浏览器的缓存中查找对应的 IP 地址，如果查找到直接返回，若找不到继续下一步

● 将请求发送给本地 DNS 服务器，在本地域名服务器缓存中查询，如果查找到，就直接将查找结果返回，若找不到继续下一步

● 本地 DNS 服务器向根域名服务器发送请求，根域名服务器会返回一个所查询域的顶级域名服务器地址

● 本地 DNS 服务器向顶级域名服务器发送请求，接受请求的服务器查询自己的缓存，如果有记录，就返回查询结果，如果没有就返回相关的下一级的权威域名服务器的地址

● 本地 DNS 服务器向权威域名服务器发送请求，域名服务器返回对应的 IP 结果

● 本地 DNS 服务器将返回结果保存在缓存中，便于下次使用

● 本地 DNS 服务器将返回结果返回给浏览器

### 迭代查询与递归查询

实际上，DNS 解析是一个包含**迭代查询和递归查询**的过程。 ● 递归查询指的是查询请求发出后，域名服务器代为向下一级域名服务器发出请求，最后向用户返回查询的最终结果。使用递归 查询，用户只需要发出一次查询请求。 ● 迭代查询指的是查询请求后，域名服务器返回单次查询的结果。下一级的查询由用户自己请求。使用迭代查询，用户需要发出 多次的查询请求。

一般我们向本地 DNS 服务器发送请求的方式就是递归查询，因为我们只需要发出一次请求，然后本地 DNS 服务器返回给我 们最终的请求结果。而本地 DNS 服务器向其他域名服务器请求的过程是迭代查询的过程，因为每一次域名服务器只返回单次 查询的结果，下一级的查询由本地 DNS 服务器自己进行。

### 参考

- [DNS](https://zhuanlan.zhihu.com/p/584431040)
