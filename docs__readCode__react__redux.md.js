(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[147],{"55Gl":function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n.n(a),c=n("dEAq"),o=n("H1Ra"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u751f\u6d3b\u4e2d\u603b\u6709\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\u53bb\u7b49\u4f60\u89e3\u51b3\uff0c\u800c\u6211\u8981\u505a\u7684\u5c31\u662f\u968f\u65f6\u505a\u597d\u51c6\u5907\uff0c\u65f6\u523b\u51c6\u5907\u7740\uff0c\u4e0d\u80fd\u653e\u677e\u3002\u4f5c\u4e3a react \u751f\u6001\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u4e2a\u6570\u636e\u6d41 \u8fd8\u662f\u8981\u6df1\u5ea6\u638c\u63e1\u3002\u75ab\u60c5\u671f\u95f4\uff0c\u662f\u7528\u6765\u6076\u8865\u81ea\u5df1\u5f31\u70b9\u7684\u6700\u4f73\u65f6\u673a\uff0c\u4e0d\u80fd\u6d6a\u8d39\uff01"),r.a.createElement("h2",{id:"\u601d\u8def"},r.a.createElement(c["AnchorLink"],{to:"#\u601d\u8def","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u601d\u8def"),r.a.createElement("p",null,"\u8fd0\u7528 reudx -> \u660e\u767d\u6838\u5fc3\u7684 api(createStore/reducer/compose/middleware) -> \u6e90\u7801\u9605\u8bfb -> \u624b\u5199 redux"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6e90\u7801\u91cc\u7684 ts \u7c7b\u578b\u597d\u590d\u6742\uff01\u770b\u5f97\u6293\u72c2\u624b\u5199\u8fc7\u7a0b\u4e2d\u7684\u51fd\u6570\u540d\u548c\u53d8\u91cf\u540d\u5c3d\u91cf\u7ed3\u5c40\u6e90\u7801")),r.a.createElement("h2",{id:"\u6838\u5fc3\u6982\u5ff5"},r.a.createElement(c["AnchorLink"],{to:"#\u6838\u5fc3\u6982\u5ff5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6838\u5fc3\u6982\u5ff5"),r.a.createElement("p",null,"state: \u5168\u5c40\u7684\u72b6\u6001\u5bf9\u8c61\uff0c\u552f\u4e00\u4e14\u4e0d\u53ef\u53d8\u3002 store: \u8c03\u7528 createStore \u51fd\u6570\u751f\u6210\u7684\u5bf9\u8c61\uff0c\u91cc\u9762\u5c01\u5165\u4e86\u5b9a\u4e49\u5728 createStore \u5185\u90e8\u7528\u4e8e\u64cd\u4f5c\u5168\u5c40\u72b6\u6001\u7684\u65b9\u6cd5\uff0c\u7528\u6237\u901a\u8fc7\u8fd9\u4e9b\u65b9\u6cd5\u4f7f\u7528 Redux\u3002 action: \u63cf\u8ff0\u72b6\u6001\u5982\u4f55\u4fee\u6539\u7684\u5bf9\u8c61\uff0c\u56fa\u5b9a\u62e5\u6709\u4e00\u4e2a type \u5c5e\u6027\uff0c\u901a\u8fc7 store \u7684 dispatch \u65b9\u6cd5\u63d0\u4ea4\u3002 reducer: \u5b9e\u9645\u6267\u884c\u72b6\u6001\u4fee\u6539\u7684\u7eaf\u51fd\u6570\uff0c\u7531\u7528\u6237\u5b9a\u4e49\u5e76\u4f20\u5165\uff0c\u63a5\u6536\u6765\u81ea dispatch \u7684 action \u4f5c\u4e3a\u53c2\u6570\uff0c\u8ba1\u7b97\u8fd4\u56de\u5168\u65b0\u7684\u72b6\u6001\uff0c\u5b8c\u6210 state \u7684\u66f4\u65b0\uff0c\u7136\u540e\u6267\u884c\u8ba2\u9605\u7684\u76d1\u542c\u51fd\u6570\u3002"),r.a.createElement("p",null,"storeEnhancer: createStore \u7684\u9ad8\u9636\u51fd\u6570\u5c01\u88c5\uff0c\u7528\u4e8e\u52a0\u5f3a store \u7684\u80fd\u529b\uff0credux \u63d0\u4f9b\u7684 applyMiddleware \u662f\u5b98\u65b9\u5b9e\u73b0\u7684\u4e00\u4e2a storeEnhancer\u3002 middleware: dispatch \u7684\u9ad8\u9636\u51fd\u6570\u5c01\u88c5\uff0c\u7531 applyMiddleware \u628a\u539f dispatch \u66ff\u6362\u4e3a\u5305\u542b middleware \u94fe\u5f0f\u8c03\u7528\u7684\u5b9e\u73b0\u3002"),r.a.createElement("h2",{id:"\u6838\u5fc3-api"},r.a.createElement(c["AnchorLink"],{to:"#\u6838\u5fc3-api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6838\u5fc3 api"),r.a.createElement("p",null,r.a.createElement(c["Link"],{to:"https://redux.js.org/api/api-reference"},"API Reference")),r.a.createElement("p",null,"Top Level export"),r.a.createElement(o["a"],{code:"createStore(reducer, [preloadedState], [enhancer]);\ncombineReducers(reducers);\napplyMiddleware(...middlewares);\nbindActionCreators(actionCreators, dispatch);\ncompose(...functions);",lang:"js"}),r.a.createElement("h2",{id:"\u624b\u5199-redux"},r.a.createElement(c["AnchorLink"],{to:"#\u624b\u5199-redux","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u624b\u5199 redux"),r.a.createElement("h3",{id:"createstorereducer-preloadedstate-enhancer"},r.a.createElement(c["AnchorLink"],{to:"#createstorereducer-preloadedstate-enhancer","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"createStore(reducer, [preloadedState], [enhancer])"),r.a.createElement("p",null,"\u521b\u5efa store \u5bf9\u8c61\uff0c\u5305\u542b getState, dispatch, subscribe, replaceReducer \u56db\u4e2a API Creates a Redux store that holds the complete state tree of your app. There should only be a single store in your app."),r.a.createElement("ul",null,r.a.createElement("li",null,"source Code")),r.a.createElement(o["a"],{code:"const createStore = function (reducer, initState, rewriteCreateStoreFunc) {\n  // \u5165\u53c3\u5904\u7406\n  if (typeof initState === 'function') {\n    initState = undefined;\n    rewriteCreateStoreFunc = initState;\n  }\n  // applymiddleware \u4e2d\u95f4\u4ef6\n  if (rewriteCreateStoreFunc) {\n    const newCreateStore = rewriteCreateStoreFunc(createStore);\n    return newCreateStore(reducer, initState);\n  }\n  let state = initState;\n  let listeners = [];\n  // \u8ba2\u9605\n  function subscribe(listener) {\n    listeners.push(listener);\n    return function unsubscribe() {\n      const index = listeners.indexOf(listener);\n      listeners.splice(index, 1);\n    };\n  }\n  // \u6539\u53d8\u72b6\u6001\n  function dispatch(action) {\n    state = reducer(state, action);\n    for (let listener of listeners) {\n      listener();\n    }\n  }\n  // \u5f97\u5230state\n  function getState() {\n    return state;\n  }\n  // \u66ff\u6362store\u5f53\u524d\u4f7f\u7528\u7684reducer\u8ba1\u7b97\u72b6\u6001\n  function replaceReducer(nextReducer) {\n    reducer = nextReducer;\n    // \u5237\u65b0\u4e00\u904dstate\u503c \u65b0\u6765\u7684reducer\u628a\u81ea\u5df1\u7684\u9ed8\u8ba4\u72b6\u6001\u653e\u5230state\u6811\u4e0a\u53bb\n    dispatch({ type: Symbol() });\n  }\n  // \u7528\u4e00\u4e2a\u4e0d\u5339\u914d\u4efb\u4f55\u8ba1\u5212\u7684type \u6765\u83b7\u53d6\u521d\u59cb\u503c\n  dispatch({ type: Symbol() });\n  return {\n    subscribe, // \u53d1\u5e03\u8ba2\u9605\n    getState, // getter\n    dispatch, // setter\n    replaceReducer,\n  };\n};\n\nexport default createStore;",lang:"js"}),r.a.createElement("p",null,"\u8fd4\u56de\u7684\u5b9e\u4f8b\u542b\u6709\u56db\u4e2a\u5c5e\u6027\u6216\u8005\u65b9\u6cd5\uff0c"),r.a.createElement(o["a"],{code:"getState();\ndispatch(action);\nsubscribe(listener);\nreplaceReducer(nextReducer);",lang:"js"}),r.a.createElement("h3",{id:"combinereducersreducers"},r.a.createElement(c["AnchorLink"],{to:"#combinereducersreducers","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"combineReducers(reducers)"),r.a.createElement("p",null,"\u591a reducer \u5408\u5e76\u6210\u4e00\u4e2a reducer"),r.a.createElement("ul",null,r.a.createElement("li",null,"source Code")),r.a.createElement(o["a"],{code:"export default function combineReducers(reducers) {\n  const reducerKeys = Object.keys(reducers);\n  // \u6574\u5408\u5408\u5e76\u540e\u7684state \u6241\u5e73\u5316\u5904\u7406\n  return function combine(state = {}, action) {\n    const nextState = {};\n    for (let i = 0; i < reducerKeys.length; i++) {\n      const key = reducerKeys[i];\n      const reducer = reducers[key];\n      const previousStateForKey = state[key];\n      const nextStateForKey = reducer(previousStateForKey, action);\n      nextState[key] = nextStateForKey;\n    }\n    return nextState;\n  };\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"demo")),r.a.createElement(o["a"],{code:"rootReducer = combineReducers({potato: potatoReducer, tomato: tomatoReducer})\n// This would produce the following state object\n{\n  potato: {\n    // ... potatoes, and other state managed by the potatoReducer ...\n  },\n  tomato: {\n    // ... tomatoes, and other state managed by the tomatoReducer, maybe some nice sauce? ...\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"applymiddlewaremiddlewares"},r.a.createElement(c["AnchorLink"],{to:"#applymiddlewaremiddlewares","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"applyMiddleware(...middlewares)"),r.a.createElement("p",null,"\u8fd4\u56de\u8ddf\u8c03\u7528",r.a.createElement("code",null,"createStore()"),"\u5bf9\u8c61\u7c7b\u4f3c"),r.a.createElement("p",null,"\u6269\u5c55 dispatch \u51fd\u6570\uff01"),r.a.createElement("ul",null,r.a.createElement("li",null,"source code")),r.a.createElement(o["a"],{code:"import compose from './compose';\nconst applyMiddleware = function (...middlewares) {\n  return function rewriteCreateStoreFunc(oldCreateStore) {\n    return function newCreateStore(reducer, initState) {\n      // generate store\n      const store = oldCreateStore(reducer, initState);\n      // \u6bcf\u4e2amiddleware\u4f20\u53c3store\n      const simpleStore = {\n        getState: store.getState,\n        dispatch: (action, ...args) => dispatch(action, ...args),\n      };\n      const chain = middlewares.map((middleware) => middleware(simpleStore));\n      // let dispatch = store.dispatch;\n      // /* \u5b9e\u73b0 exception(time((logger(dispatch))))*/\n      // chain.reverse().forEach((middleware) => {\n      //   dispatch = middleware(dispatch);\n      // });\n      // store.dispatch = dispatch;\n      // return store;\n      const dispatch = compose(...chain)(store.dispatch);\n      return {\n        ...store,\n        dispatch,\n      };\n    };\n  };\n};\nexport default applyMiddleware;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"demo")),r.a.createElement(o["a"],{code:"const loggerMiddleWare = (store) => (next) => (action) => {\n  console.log('this.state logger', store.getState());\n  next(action);\n  console.log('next state logger', store.getState());\n};\nconst exceptionMiddleware = (store) => (next) => {\n  return (action) => {\n    try {\n      next(action);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n};\nconst rewriteCreateStoreFunc = applyMiddleware(exceptionMiddleware, loggerMiddleWare);\nconst store = createStore(reduces, initStates, rewriteCreateStoreFunc);",lang:"js"}),r.a.createElement("h3",{id:"bindactioncreatorsactioncreators-dispatch"},r.a.createElement(c["AnchorLink"],{to:"#bindactioncreatorsactioncreators-dispatch","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"bindActionCreators(actionCreators, dispatch)"),r.a.createElement("ul",null,r.a.createElement("li",null,"source code")),r.a.createElement(o["a"],{code:"function bindActionCreator(actionCreator, dispatch) {\n  return function () {\n    return dispatch(actionCreator.apply(this, arguments));\n  };\n}\n// \u901a\u8fc7\u95ed\u5305 \u9690\u85cfdispatch actionCreator\nexport default function bindActionCreators(actionCreators, dispatch) {\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch);\n  }\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error('actionCreators occur error');\n  }\n  const keys = Object.keys(actionCreators);\n  const boundActionCreators = {};\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    const actionCreator = actionCreators[key];\n    if (typeof actionCreator === 'function') {\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);\n    }\n  }\n  return boundActionCreators;\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"demo")),r.a.createElement(o["a"],{code:"function increment() {\n  return {\n    type: 'INCREMENT',\n  };\n}\nfunction setName(name) {\n  return {\n    type: 'SET_NAME',\n    name,\n  };\n}\n// \u6241\u5e73\u5316\u7684actions\nconst actions = bindActionCreators(\n  {\n    increment,\n    setName,\n  },\n  store.dispatch,\n);\nactions.increment();\nactions.setName('cpp');",lang:"js"}),r.a.createElement("h3",{id:"composefunctions"},r.a.createElement(c["AnchorLink"],{to:"#composefunctions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"compose(...functions)"),r.a.createElement("p",null,"compose(\u7ec4\u5408)\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u8303\u5f0f\u4e2d\u7ecf\u5e38\u7528\u5230\u7684\u4e00\u79cd\u5904\u7406\uff0c\u5b83\u521b\u5efa\u4e00\u4e2a\u4ece\u53f3\u5230\u5de6\u7684\u6570\u636e\u6d41\uff0c\u53f3\u8fb9\u51fd\u6570\u6267\u884c\u7684\u7ed3\u679c\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u5de6\u8fb9\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"source code")),r.a.createElement(o["a"],{code:"export default function compose(...funs) {\n  if (!funs.length) {\n    return (arg) => arg;\n  }\n  if (funs.length === 1) return funs[0];\n  return funs.reduce(\n    (a, b) =>\n      (...args) =>\n        a(b(args)),\n  );\n}\n// demo\n// var double = (x) => x * 2;\n// var three = (x) => x * 3;\n// var sum = compose(double, three);\n// var total = sum(10);\n// console.log(total); // 60",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"demo")),r.a.createElement(o["a"],{code:"import { createStore, applyMiddleware, compose } from 'redux';\nimport thunk from 'redux-thunk';\nimport DevTools from './containers/DevTools';\nimport reducer from '../reducers';\n\nconst store = createStore(reducer, compose(applyMiddleware(thunk), DevTools.instrument()));",lang:"js"}),r.a.createElement("h2",{id:"\u4f7f\u7528-redux"},r.a.createElement(c["AnchorLink"],{to:"#\u4f7f\u7528-redux","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 redux"),r.a.createElement(o["a"],{code:"const App = () => {\n  const state = store.getState();\n  // \u5f3a\u5236\u5237\u65b0\u4e86\n  const [, forceRender] = useReducer((c) => c + 1, 0);\n  // \u8ba2\u9605\u66f4\u65b0,\u72b6\u6001\u53d8\u66f4\u5237\u65b0\u7ec4\u4ef6\n  useEffect(() => {\n    // \u7ec4\u4ef6\u9500\u6bc1\u65f6\u53d6\u6d88\u8ba2\u9605\n    return store.subscribe(() => {\n      forceRender();\n    });\n  }, []);\n  const onIncrement = () => {\n    store.dispatch({ type: 'increment' });\n  };\n  const onDecrement = () => {\n    store.dispatch({ type: 'decrement' });\n  };\n  return (\n    <div style={{ textAlign: 'center', marginTop: '35%' }}>\n      <h1 style={{ color: 'green', fontSize: '500%' }}>{state.count}</h1>\n      <button onClick={onDecrement} style={{ marginRight: '10%' }}>\n        decrement\n      </button>\n      <button onClick={onIncrement}>increment</button>\n    </div>\n  );\n};",lang:"js"}),r.a.createElement("h2",{id:"other"},r.a.createElement(c["AnchorLink"],{to:"#other","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"other"),r.a.createElement("h3",{id:"pure-function-\u7eaf\u51fd\u6570"},r.a.createElement(c["AnchorLink"],{to:"#pure-function-\u7eaf\u51fd\u6570","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"pure function \u7eaf\u51fd\u6570"),r.a.createElement("p",null,"\u7eaf\u51fd\u6570\u7684\u7279\u70b9\u662f\u51fd\u6570\u8f93\u51fa\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u5916\u90e8\u53d8\u91cf\uff0c\u76f8\u540c\u7684\u8f93\u5165\u4e00\u5b9a\u4f1a\u4ea7\u751f\u76f8\u540c\u7684\u8f93\u51fa\uff0c\u975e\u5e38\u7a33\u5b9a\u3002\u4f7f\u7528\u5b83\u6765\u8fdb\u884c\u5168\u5c40\u72b6\u6001\u4fee\u6539\uff0c\u4f7f\u5f97\u5168\u5c40\u72b6\u6001\u53ef\u4ee5\u88ab\u9884\u6d4b\u3002"),r.a.createElement("h3",{id:"\u4ec0\u4e48\u662f-thunk"},r.a.createElement(c["AnchorLink"],{to:"#\u4ec0\u4e48\u662f-thunk","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ec0\u4e48\u662f thunk"),r.a.createElement("p",null,"calculation delay \u5ef6\u8fdf\u8ba1\u7b97\uff0c\u770b\u4e0b demo \u5c31\u660e\u767d\u4e86"),r.a.createElement(o["a"],{code:"function wrapped(arg) {\n  return function thunk(...rest) {\n    console.log('thunk ', arg, rest);\n  };\n}\nconst thunk = wrapped('cpp');\nthunk('wmh');",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6709\u70b9\u7c7b\u4f3c\u51fd\u6570\u7f16\u7a0b\u91cc\u7684\u67ef\u91cc\u5316")),r.a.createElement("h3",{id:"react-thunk"},r.a.createElement(c["AnchorLink"],{to:"#react-thunk","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"react-thunk"),r.a.createElement("p",null,"dispatch \u6d3e\u53d1 action \u7684\u65f6\u5019\u9614\u4ee5\u4f20\u4e00\u4e2a function\uff0c\u5c31\u662f\u4e00\u4e2a\u6807\u51c6\u7684 redux middleware"),r.a.createElement(o["a"],{code:"const createThunkMiddleware(extra) {\n  return ({dispatch, getState}) => next => action => {\n    if (typeof action === 'function') {\n     return action(dispatch, getState, extra)\n    }\n    return next(action)\n  }\n}\nconst thunk = createThunkMiddleware({})\nthunk.withExtraArgument = createThunkMiddleware\nexport default thunk",lang:"js"}),r.a.createElement("h2",{id:"\u53c2\u8003\u94fe\u63a5"},r.a.createElement(c["AnchorLink"],{to:"#\u53c2\u8003\u94fe\u63a5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003\u94fe\u63a5"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(c["Link"],{to:"https://mp.weixin.qq.com/s/siBfMEjojpEzLIlDpnaBCg"},"\u4f60\u662f\u8fd9\u6837\u7406\u89e3 redux \u7684\u5417\uff1f")),r.a.createElement("li",null,r.a.createElement(c["Link"],{to:"https://mp.weixin.qq.com/s/SdD8_yCYmGFmnDtaZGxy5w"},"React \u72b6\u6001\u7ba1\u7406 - \u4f60\u53ef\u80fd\u4e0d\u9700\u8981 Redux\uff0c\u4f46\u4f60\u9700\u8981\u4e86\u89e3\u5b83")),r.a.createElement("li",null,r.a.createElement(c["Link"],{to:"https://mp.weixin.qq.com/s/t7W0ulMaq5_8MxuiyTvXvw"},"Redux \u901a\u5173\u7b80\u6d01\u653b\u7565 -- \u770b\u8fd9\u4e00\u7bc7\u5c31\u591f\u4e86\uff01")),r.a.createElement("li",null,r.a.createElement(c["Link"],{to:"https://zhuanlan.zhihu.com/p/85403048"},"\u7406\u89e3 redux-thunk")),r.a.createElement("li",null,r.a.createElement(c["Link"],{to:"https://codesandbox.io/s/yv6kqo1yw9"},"react-redux demo")))))}));t["default"]=e=>{var t=r.a.useContext(c["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&c["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}}}]);