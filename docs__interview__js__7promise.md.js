(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[58],{"O+tG":function(e,n,r){"use strict";r.r(n);var t=r("q1tI"),l=r.n(t),s=r("dEAq"),o=r("H1Ra"),a=l.a.memo((e=>{e.demos;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("p",null,"\u9762\u8bd5\u5e38\u8003\u9898\uff0c\u624b\u5199 Promise \u4ee5\u53ca\u76f8\u5173 api"),l.a.createElement("p",null,"JavaScript \u4e2d\u5b58\u5728\u5f88\u591a\u5f02\u6b65\u64cd\u4f5c,Promise \u5c06\u5f02\u6b65\u64cd\u4f5c\u961f\u5217\u5316\uff0c\u6309\u7167\u671f\u671b\u7684\u987a\u5e8f\u6267\u884c\uff0c\u8fd4\u56de\u7b26\u5408\u9884\u671f\u7684\u7ed3\u679c\u3002\u53ef\u4ee5\u901a\u8fc7\u94fe\u5f0f\u8c03\u7528\u591a\u4e2a Promise \u8fbe\u5230\u6211\u4eec\u7684\u76ee\u7684\u3002"),l.a.createElement("p",null,"Promise \u662f\u4e00\u4e2a\u62e5\u6709 then \u51fd\u6570\u7684\u5bf9\u8c61\u6216\u8005\u65b9\u6cd5,"),l.a.createElement("p",null,"Promise \u5bf9\u8c61\u7528\u4e8e\u8868\u793a\u4e00\u4e2a\u5f02\u6b65\u64cd\u4f5c\u7684\u6700\u7ec8\u5b8c\u6210 (\u6216\u5931\u8d25)\u53ca\u5176\u7ed3\u679c\u503c\u3002"),l.a.createElement("h2",{id:"promise-\u6838\u5fc3\u7406\u5ff5"},l.a.createElement(s["AnchorLink"],{to:"#promise-\u6838\u5fc3\u7406\u5ff5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Promise \u6838\u5fc3\u7406\u5ff5"),l.a.createElement("h3",{id:"\u5f02\u6b65\u72b6\u6001"},l.a.createElement(s["AnchorLink"],{to:"#\u5f02\u6b65\u72b6\u6001","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u5f02\u6b65\u72b6\u6001"),l.a.createElement("p",null,"Promise \u7406\u89e3\u4e3a\u627f\u8bfa\uff0c\u627f\u8bfa\u4e00\u6bb5\u65f6\u95f4\u540e\u4f1a\u7ed9\u51fa\u7ed3\u679c\uff0c\u5982\u679c\u7ed9\u51fa\u7ed3\u679c\u4e86\u5c31\u662f\u6210\u529f\u72b6\u6001\uff0c\u5982\u679c\u89c4\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u7ed9\u51fa\u7ed3\u679c\u5c31\u662f\u5931\u8d25\u72b6\u6001"),l.a.createElement("p",null,"\u4e00\u4e2a promise \u5fc5\u987b\u6709\u4e00\u4e2a ",l.a.createElement("strong",null,"then")," \u65b9\u6cd5\u7528\u4e8e\u5904\u7406\u72b6\u6001\u6539\u53d8"),l.a.createElement("h3",{id:"\u72b6\u6001\u8bf4\u660e"},l.a.createElement(s["AnchorLink"],{to:"#\u72b6\u6001\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u72b6\u6001\u8bf4\u660e"),l.a.createElement("p",null,"Promise \u5305\u542b",l.a.createElement("strong",null,"pending\u3001fulfilled\u3001rejected"),"\u4e09\u79cd\u72b6\u6001"),l.a.createElement("p",null,"pending \u6307\u521d\u59cb\u7b49\u5f85\u72b6\u6001\uff0c\u521d\u59cb\u5316 promise \u65f6\u7684\u72b6\u6001 resolve \u6307\u5df2\u7ecf\u89e3\u51b3\uff0c\u5c06 promise \u72b6\u6001\u8bbe\u7f6e\u4e3a fulfilled reject \u6307\u62d2\u7edd\u5904\u7406\uff0c\u5c06 promise \u72b6\u6001\u8bbe\u7f6e\u4e3a rejected promise \u662f\u751f\u4ea7\u8005\uff0c\u901a\u8fc7 resolve \u4e0e reject \u51fd\u6570\u544a\u4e4b\u7ed3\u679c promise \u975e\u5e38\u9002\u5408\u9700\u8981\u4e00\u5b9a\u6267\u884c\u65f6\u95f4\u7684\u5f02\u6b65\u4efb\u52a1"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u72b6\u6001\u4e00\u65e6\u6539\u53d8\u5c06\u4e0d\u53ef\u66f4\u6539\uff0c\u5982\u679c\u6ca1\u6709\u8c03\u7528 resolve \u6216\u8005 reject \u65b9\u6cd5 status \u5c06\u4f1a\u4e00\u76f4\u4fdd\u6301 pending \u72b6\u6001,\u5f53\u8c03\u7528 resolve \u6216\u8005 reject \u65b9\u6cd5\u5c06\u66f4\u6539\u72b6\u6001")),l.a.createElement(o["a"],{code:"let resolveP = null;\nvar p1 = new Promise((resolve) => {\n  resolveP = resolve;\n  console.log(11);\n});\nconsole.log(p1);",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,"promise \u521b\u5efa\u65f6\u5373\u7acb\u5373\u6267\u884c\u5373\u540c\u6b65\u4efb\u52a1\uff0cthen \u4f1a\u653e\u5728",l.a.createElement("strong",null,"\u5f02\u6b65\u5fae\u4efb\u52a1"),"\u4e2d\u6267\u884c\uff0c\u9700\u8981\u7b49\u540c\u6b65\u4efb\u52a1\u6267\u884c\u540e\u624d\u6267\u884c\u3002")),l.a.createElement("h3",{id:"then"},l.a.createElement(s["AnchorLink"],{to:"#then","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"then"),l.a.createElement("p",null,"\u4e00\u4e2a Promise \u9700\u8981 then \u51fd\u6570\u8bbf\u95ee promise \u7ed3\u679c\uff0cthen \u7528\u4e8e\u5b9a\u4e49\u5f53 promise \u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\u7684\u5904\u7406"),l.a.createElement("p",null,"then \u65b9\u6cd5\u5fc5\u987b",l.a.createElement("strong",null,"\u8fd4\u56de")," promise\uff0c\u7528\u6237\u8fd4\u56de\u6216\u7cfb\u7edf\u81ea\u52a8\u8fd4\u56de\u7b2c\u4e00\u4e2a\u51fd\u6570\u5728 ",l.a.createElement("strong",null,"resolved")," \u72b6\u6001\u65f6\u6267\u884c\uff0c\u5373\u6267\u884c resolve \u65f6\u6267\u884c then \u7b2c\u4e00\u4e2a\u51fd\u6570\u5904\u7406\u6210\u529f\u72b6\u6001\u7b2c\u4e8c\u4e2a\u51fd\u6570\u5728 ",l.a.createElement("strong",null,"rejected")," \u72b6\u6001\u65f6\u6267\u884c\uff0c\u5373\u6267\u884c reject \u65f6\u6267\u884c\u7b2c\u4e8c\u4e2a\u51fd\u6570\u5904\u7406\u5931\u8d25\u72b6\u6001\uff0c\u8be5\u51fd\u6570\u662f\u53ef\u9009\u7684\u4e24\u4e2a\u51fd\u6570\u90fd\u63a5\u6536 promise ",l.a.createElement("strong",null,"\u4f20\u51fa"),"\u7684\u503c\u505a\u4e3a\u53c2\u6570\u4e5f\u53ef\u4ee5\u4f7f\u7528 catch \u6765\u5904\u7406\u5931\u8d25\u7684\u72b6\u6001\u5982\u679c then \u8fd4\u56de promise \uff0c\u4e0b\u4e00\u4e2a then \u4f1a\u5728\u5f53\u524d promise \u72b6\u6001\u6539\u53d8\u540e\u6267\u884c\uff0c\u652f\u6301\u94fe\u5f0f\u8c03\u7528"),l.a.createElement("h4",{id:"\u8bed\u6cd5\u8bf4\u660e"},l.a.createElement(s["AnchorLink"],{to:"#\u8bed\u6cd5\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u8bed\u6cd5\u8bf4\u660e"),l.a.createElement("p",null,"then \u7684\u8bed\u6cd5\u5982\u4e0b\uff0conFulfilled \u51fd\u6570\u5904\u7406 fulfilled \u72b6\u6001\uff0c onRejected \u51fd\u6570\u5904\u7406 rejected \u72b6\u6001"),l.a.createElement("p",null,"onFulfilled \u6216 onRejected \u4e0d\u662f\u51fd\u6570\u5c06\u88ab\u5ffd\u7565\u4e24\u4e2a\u51fd\u6570\u53ea\u4f1a\u88ab\u8c03\u7528\u4e00\u6b21 onFulfilled \u5728 promise \u6267\u884c\u6210\u529f\u65f6\u8c03\u7528 onRejected \u5728 promise \u6267\u884c\u62d2\u7edd\u65f6\u8c03\u7528 ",l.a.createElement("code",null,"Promise.then(onFulfilled, onRejected)")),l.a.createElement("h3",{id:"\u94fe\u5f0f\u8c03\u7528"},l.a.createElement(s["AnchorLink"],{to:"#\u94fe\u5f0f\u8c03\u7528","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u94fe\u5f0f\u8c03\u7528"),l.a.createElement("p",null,"\u6bcf\u6b21\u7684 then \u90fd\u662f\u4e00\u4e2a\u5168\u65b0\u7684 promise\uff0c\u9ed8\u8ba4 then \u8fd4\u56de\u7684 promise \u72b6\u6001\u662f ",l.a.createElement("strong",null,"fulfilled")),l.a.createElement(o["a"],{code:"var p1 = new Promise((resolve) => {\n  resolve('cpp');\n});\nvar p2 = p1.then((res) => console.log(res));\np2.then(() => {\n  console.log('P2 then');\n});\n\n// console.log(p1) // Promise {<fulfilled>}\n// console.log(p2) // Promise {<pending>}\n\nsetTimeout(() => {\n  console.log(p1); // Promise {<fulfilled>: 'cpp'}\n  console.log(p2); // Promise\xa0{<fulfilled>: undefined}\n});",lang:"js"}),l.a.createElement("p",null,"\u6bcf\u6b21\u7684 then \u90fd\u662f\u4e00\u4e2a\u5168\u65b0\u7684 promise\uff0c\u4e0d\u8981\u8ba4\u4e3a\u4e0a\u4e00\u4e2a promise \u72b6\u6001\u4f1a\u5f71\u54cd\u4ee5\u540e then \u8fd4\u56de\u7684\u72b6\u6001"),l.a.createElement("p",null,"\u5982\u679c then \u8fd4\u56de promise \u65f6\uff0c\u540e\u9762\u7684 then \u5c31\u662f\u5bf9\u8fd4\u56de\u7684 promise \u7684\u5904\u7406\uff0c\u9700\u8981\u7b49\u5f85\u8be5 promise \u53d8\u66f4\u72b6\u6001\u540e\u6267\u884c\u3002"),l.a.createElement(o["a"],{code:"var promise = new Promise((resolve) => {\n  resolve('cpp');\n});\nvar p1 = promise\n  .then(() => {\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        resolve('setTimeout');\n      }, 1000);\n    });\n  })\n  .then((res) => {\n    console.log('res', res);\n  });",lang:"js"}),l.a.createElement("h3",{id:"thenable"},l.a.createElement(s["AnchorLink"],{to:"#thenable","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"thenable"),l.a.createElement("p",null,l.a.createElement(s["Link"],{to:"https://doc.houdunren.com/js/15%20Promise.html#%E5%85%B6%E5%AE%83%E7%B1%BB%E5%9E%8B"},"thenable")," Promise.resolve \u5305\u542b then \u65b9\u6cd5\u7684\u5bf9\u8c61\u5c31\u662f\u4e00\u4e2a promise \uff0c\u7cfb\u7edf\u5c06\u4f20\u9012 resolvePromise \u4e0e rejectPromise \u505a\u4e3a\u51fd\u6570\u53c2\u6570"),l.a.createElement("p",null,"\u4e0b\u4f8b\u4e2d\u4f7f\u7528 resolve \u6216\u5728 then \u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e86\u5177\u6709 then \u65b9\u6cd5\u7684\u5bf9\u8c61"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u8be5\u5bf9\u8c61\u5373\u4e3a promise \u8981\u5148\u6267\u884c\uff0c\u5e76\u5728\u65b9\u6cd5\u5185\u90e8\u66f4\u6539\u72b6\u6001"),l.a.createElement("li",null,"\u5982\u679c\u4e0d\u66f4\u6539\u72b6\u6001\uff0c\u540e\u9762\u7684 then promise \u90fd\u4e3a\u7b49\u5f85\u72b6\u6001")),l.a.createElement(o["a"],{code:"var p1 = new Promise((resolve) => {\n  window.resolve = resolve;\n});\nvar p2 = p1\n  .then((res) => {\n    console.log(`fulfilled: ${res}`);\n    return {\n      then(resolve, reject) {\n        reject('rejected');\n      },\n    };\n  })\n  .then(null, (err) => {\n    console.log(err, 'err');\n  });\n// resolve\u5305\u542bthen\u5219\u76f8\u5f53\u4e8e resolve(new Promise(resolve => resolve()))\nresolve({\n  then(resolve, reject) {\n    resolve('p1 \u5185\u90e8\u7684then');\n  },\n});\nconsole.log(p1, p2); // Promise\xa0{<pending>} Promise\xa0{<pending>}\n// p1 \u5185\u90e8\u7684then\n// rejected err",lang:"js"}),l.a.createElement("p",null,"\u6539\u9020\u4e0b,resolve \u91cc\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a promise,\u7ed3\u679c\u662f\u8ddf\u4e0a\u9762\u7684\u4e00\u6837"),l.a.createElement(o["a"],{code:"var p1 = new Promise((resolve) => {\n  window.resolve = resolve;\n});\nvar p2 = p1\n  .then((res) => {\n    console.log(`fulfilled: ${res}`);\n    return {\n      then(resolve, reject) {\n        reject('rejected');\n      },\n    };\n  })\n  .then(null, (err) => {\n    console.log(err, 'err');\n  });\n// resolve\u5305\u542bthen\u5219\u76f8\u5f53\u4e8e resolve(new Promise(resolve => resolve()))\nresolve(\n  new Promise((resolve) => {\n    resolve('p1 \u5185\u90e8\u7684then');\n  }),\n);\nconsole.log(p1, p2); // Promise\xa0{<pending>} Promise\xa0{<pending>}\n// p1 \u5185\u90e8\u7684then\n// rejected err",lang:"js"}),l.a.createElement("h3",{id:"\u624b\u5199\u8f83\u4e3a\u6b63\u5e38\u4e00\u70b9\u7684-promise"},l.a.createElement(s["AnchorLink"],{to:"#\u624b\u5199\u8f83\u4e3a\u6b63\u5e38\u4e00\u70b9\u7684-promise","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u624b\u5199\u8f83\u4e3a\u6b63\u5e38\u4e00\u70b9\u7684 Promise"),l.a.createElement("blockquote",null,l.a.createElement("p",null,"\u4f46\u59cb\u7ec8\u6709\u4e00\u53e5\u6ca1\u80fd\u6df1\u523b\u7406\u89e3 res.then(resolve, reject)")),l.a.createElement("p",null,"\u4eca\u5929\u53c8\u6765\u770b\u8fd9\u4e2a\u77e5\u8bc6\u70b9\uff0c\u60f3\u60f3\u4e3a\u5565\u6211\u5199\u4e0d\u51fa\u6765 axios \u8fd9\u79cd\u725b\u903c\u7684 http \u6709\u4e0b\u5217 API ",l.a.createElement(s["Link"],{to:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"},"Promise")),l.a.createElement(o["a"],{code:"PromiseTest.prototype.then(onFulfilled, onRejected);\nPromiseTest.prototype.finally(fn);\nPromiseTest.prototype.catch(onRejected);\nPromiseTest.resolve(value);\nPromiseTest.reject(reason);\nPromiseTest.all(iterable);\nPromiseTest.any(iterable);\nPromiseTest.race(iterable);\nPromiseTest.allSettled(iterable);",lang:"js"}),l.a.createElement(o["a"],{code:"class PromiseTest {\n  static PENDING = 'pending';\n  static FULFILLED = 'fulfilled';\n  static REJECTED = 'rejected';\n  constructor(executor) {\n    this.status = PromiseTest.PENDING;\n    this.value = undefined;\n    this.cbs = [];\n    try {\n      executor(this.resolve.bind(this), this.reject.bind(this));\n    } catch (e) {\n      this.reject(e);\n    }\n  }\n  // pending\u5f02\u6b65\n  resolve(value) {\n    // \u72b6\u6001\u4e00\u65e6\u6539\u53d8\u5c31\u4e0d\u80fd\u5728\u53d8\n    if (this.status === PromiseTest.PENDING) {\n      setTimeout(() => {\n        this.status = PromiseTest.FULFILLED;\n        this.value = value;\n        this.cbs.forEach((fn) => fn.onFulfilled(value));\n      });\n    }\n  }\n  // pending\u5f02\u6b65\n  reject(value) {\n    // \u72b6\u6001\u4e00\u65e6\u6539\u53d8\u5c31\u4e0d\u80fd\u5728\u53d8\n    if (this.status === PromiseTest.PENDING) {\n      setTimeout(() => {\n        this.status = PromiseTest.REJECTED;\n        this.value = value;\n        this.cbs.forEach((fn) => fn.onRejected(value));\n      });\n    }\n  }\n  then(onFulfilled, onRejected) {\n    if (typeof onFulfilled !== 'function') {\n      onFulfilled = (val) => val;\n    }\n    if (typeof onRejected !== 'function') {\n      onRejected = (res) => res;\n    }\n    let p1 = new PromiseTest((resolve, reject) => {\n      // \u5904\u7406\u5b9a\u65f6\u5668 new Promise((resolve) => setTimeout(() => resolve('cpp')))\n      // \u9700\u8981\u4e00\u4e2a\u961f\u5217\u4fdd\u5b58\u6784\u9020\u51fd\u6570\u4e2d\u7684\u540c\u6b65\u51fd\u6570\n      if (this.status === PromiseTest.PENDING) {\n        this.cbs.push({\n          onFulfilled: (value) => {\n            try {\n              this.parse(p1, onFulfilled(value), resolve, reject);\n            } catch (e) {\n              reject(e);\n            }\n          },\n          onRejected: (value) => {\n            try {\n              this.parse(p1, onFulfilled(value), resolve, reject);\n            } catch (e) {\n              reject(e);\n            }\n          },\n        });\n      }\n      if (this.status === PromiseTest.FULFILLED) {\n        // then\u65b9\u6cd5\u662f\u5fae\u4efb\u52a1 \u6682\u65f6\u7531queueMicrotask\u4ee3\u66ff\n        queueMicrotask(() => {\n          try {\n            this.parse(p1, onFulfilled(this.value), resolve, reject);\n          } catch (e) {\n            let res = onRejected(e);\n            reject(res);\n          }\n        });\n      }\n      if (this.status === PromiseTest.REJECTED) {\n        queueMicrotask(() => {\n          try {\n            this.parse(p1, onFulfilled(this.value), resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        });\n      }\n    });\n    return p1;\n  }\n  // \u62bd\u79bb\u6210\u65b9\u6cd5\n  parse(p1, res, resolve, reject) {\n    if (p1 === res) {\n      throw new TypeError('Chaining cycle detected for promise');\n    }\n    try {\n      // \u5982\u679c\u8fd4\u56de\u503c\u662fPromise\n      // \u5982\u679c\u8fd4\u56de\u503c\u662fpromise\u5bf9\u8c61\uff0c\u8fd4\u56de\u503c\u4e3a\u6210\u529f\uff0c\u65b0promise\u5c31\u662f\u6210\u529f\n      // \u5982\u679c\u8fd4\u56de\u503c\u662fpromise\u5bf9\u8c61\uff0c\u8fd4\u56de\u503c\u4e3a\u5931\u8d25\uff0c\u65b0promise\u5c31\u662f\u5931\u8d25\n      // \u8c01\u77e5\u9053\u8fd4\u56de\u7684promise\u662f\u5931\u8d25\u6210\u529f\uff1f\u53ea\u6709then\u77e5\u9053 \u5219\u76f8\u5f53\u4e8ePromise.then(resolve, reject)\n      if (res instanceof PromiseTest) {\n        res.then(resolve, reject);\n      } else {\n        // \u8fd4\u56de\u503c\u662f\u975epromise\u5bf9\u8c61 \u65b0\u7684promise\u5bf9\u8c61\u5c31\u662f\u6210\u529f \u76f4\u63a5\u8fd4\u56de\u503c\n        resolve(res);\n      }\n    } catch (e) {\n      reject(e);\n    }\n  }\n  // catch() \u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aPromise\uff0c\u5e76\u4e14\u5904\u7406\u62d2\u7edd\u7684\u60c5\u51b5\n  catch(onRejected) {\n    return this.then(null, onRejected);\n  }\n  // Promise.resolve()\n  // \u5b9e\u4f8b\u5316\u4e00\u4e2a\u89e3\u51b3(fulFilled)\u7684Promise\n  static resolve(val) {\n    return new PromiseTest((resolve, reject) => {\n      if (val instanceof PromiseTest) {\n        val.then(resolve, reject);\n      } else {\n        resolve(val);\n      }\n    });\n  }\n  // Promise.reject\n  // \u5b9e\u4f8b\u5316\u4e00\u4e2a\u5931\u8d25\u7684rejected\u7684Promise \u5e76\u629b\u51fa\u4e00\u4e2a\u5f02\u6b65\u9519\u8bef\n  static reject(res) {\n    return new PromiseTest((resolve, reject) => {\n      reject(res);\n    });\n  }\n  // Promise.all()\n  static all(arr = []) {\n    let result = [];\n    return new PromiseTest((resolve, reject) => {\n      for (let [index, item] of arr.entries()) {\n        PromiseTest.resolve(item).then(\n          (res) => {\n            result.push(res);\n            if (index === arr.length - 1) {\n              resolve(result);\n            }\n          },\n          (err) => {\n            reject(err);\n          },\n        );\n      }\n    });\n  }\n  // Promise.any() \u5982\u679c\u6709\u4e00\u4e2aPromise \u6210\u529f\u5219\u8fd4\u56de\n  // \u5982\u679c\u90fd\u5931\u8d25\u5219rejected\n  static any(arr = []) {\n    return new PromiseTest((resolve, reject) => {\n      const len = arr.length;\n      if (len === 0) {\n        return resolve([]);\n      }\n      for (let [index, item] of arr.entries()) {\n        PromiseTest.resolve(item).then(\n          (res) => {\n            return resolve(res);\n          },\n          (err) => {\n            if (len === index + 1) {\n              reject(new TypeError('AggregateError: All promises were rejected'));\n            }\n          },\n        );\n      }\n    });\n  }\n  // Promise.race()\n  // \u8fd4\u56de\u4e00\u4e2a\u5408\u6210\u7684Promise\u5b9e\u4f8b\uff0c\u8fd4\u56de\u6700\u5148\u89e3\u51b3\u7684\u6216\u8005\u62d2\u63a5\u7684Promise\u5b9e\u4f8b\u8fd4\u56de\u503c\n  static race(arr = []) {\n    return new PromiseTest((resolve, reject) => {\n      for (let [index, item] of arr.entries()) {\n        PromiseTest.resolve(item).then(\n          (res) => {\n            resolve(res);\n          },\n          (err) => {\n            reject(err);\n          },\n        );\n      }\n    });\n  }\n  // Promise.allSettled\n  // \u8fd4\u56de\u4e00\u4e2a\u5408\u6210\u7684promise \u4e0d\u8fc7\u662f\u8981\u7b49\u5230\u6240\u6709\u7684promise\u90fd\u5df2\u7ecf\u5904\u7406\u5b8c\u6210\uff0c\u4e0d\u7ba1\u662f\u5931\u8d25\u8fd8\u662f\u6210\u529f\uff0c\u5176\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u6570\u7ec4\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u6709\u5bf9\u5e94\u7684promise\u7ed3\u679c\n  static allSettled(arr = []) {\n    return new PromiseTest((resolve, reject) => {\n      let len = arr.length;\n      let res = [];\n      if (len === 0) return resolve(res);\n      for (let [index, item] of arr.entries()) {\n        PromiseTest.resolve(item).then(\n          (res) => {\n            res[index] = {\n              value: res,\n              status: 'fulfilled',\n            };\n            if (index + 1 === len) {\n              resolve(res);\n            }\n          },\n          (err) => {\n            res[index] = {\n              status: 'rejected',\n              reason: err,\n            };\n            if (index + 1 === len) {\n              resolve(res);\n            }\n          },\n        );\n      }\n    });\n  }\n  // the second try\n  static allSettled2(arr = []) {\n    let promiseArr = [...arr];\n    return PromiseTest.all(\n      promiseArr.map((item) => {\n        Promise.resolve(item).then(\n          (res) => {\n            return {\n              status: 'fulfilled',\n              value: res,\n            };\n          },\n          (err) => {\n            return {\n              status: 'rejected',\n              reason: err,\n            };\n          },\n        );\n      }),\n    );\n  }\n  // finally \u539f\u578b\u4e0a\u7684\n  // finally() \u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aPromise\u3002\u5728promise\u7ed3\u675f\u65f6\uff0c\u65e0\u8bba\u7ed3\u679c\u662ffulfilled\u6216\u8005\u662frejected\uff0c\u90fd\u4f1a\u6267\u884c\u6307\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u3002\u8fd9\u4e3a\u5728Promise\u662f\u5426\u6210\u529f\u5b8c\u6210\u540e\u90fd\u9700\u8981\u6267\u884c\u7684\u4ee3\u7801\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u5f0f\n  finally(cb) {\n    return this.then(\n      (val) => PromiseTest.resolve(cb()).then(() => val),\n      (err) => PromiseTest.resolve(cb()).then(() => throw err),\n    );\n  }\n}\n\nif (typeof window.queueMicrotask !== 'function') {\n  window.queueMicrotask = function (callback) {\n    Promise.resolve()\n      .then(callback)\n      .catch((e) =>\n        setTimeout(() => {\n          throw e;\n        }),\n      );\n  };\n}\n\n// demo\nlet p3 = new PromiseTest((resolve, reject) => {\n  resolve('p1');\n  console.log('start');\n})\n  .then(\n    (res) => {\n      console.log(res, 'then1');\n      return 'Cpp then';\n    },\n    (err) => {\n      console.log(err);\n    },\n  )\n  .then(\n    (res) => {\n      console.log(res, 'then2');\n      return 'CPP then2';\n    },\n    (err) => {\n      console.log(err);\n    },\n  )\n  .then((res) => {\n    console.log(res, 'then3');\n  });",lang:"js"}),l.a.createElement("h3",{id:"promise-\u5f02\u5e38\u6355\u83b7"},l.a.createElement(s["AnchorLink"],{to:"#promise-\u5f02\u5e38\u6355\u83b7","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"promise \u5f02\u5e38\u6355\u83b7"),l.a.createElement(o["a"],{code:"var p1 = new Promise((resolve, reject) => {\n  reject('p1 is rejected');\n});\np1.then((res) => {\n  console.log('p1 then');\n  return new Promise((resolve, reject) => {\n    resolve('p1 return resolve');\n  });\n})\n  .then((res) => {\n    console.log('p1 then then:', res);\n  })\n  .catch((err) => {\n    console.log('p1 catch:', err);\n  });",lang:"js"}),l.a.createElement("h2",{id:"\u53c2\u8003"},l.a.createElement(s["AnchorLink"],{to:"#\u53c2\u8003","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(s["Link"],{to:"https://doc.houdunren.com/js/15%20Promise.html#promise"},"\u540e\u76fe\u4eba")),l.a.createElement("li",null,l.a.createElement(s["Link"],{to:"https://juejin.cn/post/6994594642280857630#heading-2"},"\u770b\u4e86\u5c31\u4f1a\uff0c\u624b\u5199 Promise \u539f\u7406\uff0c\u6700\u901a\u4fd7\u6613\u61c2\u7684\u7248\u672c\uff01\uff01\uff01")),l.a.createElement("li",null,l.a.createElement(s["Link"],{to:"https://juejin.cn/post/6907673648216145928#heading-19"},"\u7ae5\u6b27\u5df4 Promise")),l.a.createElement("li",null,l.a.createElement(s["Link"],{to:"https://segmentfault.com/a/1190000039275224"},"\u6d9b\u54e5")),l.a.createElement("li",null,l.a.createElement(s["Link"],{to:"https://juejin.cn/post/6847902216028848141"},"\u5982\u4f55\u4e2d\u65ad Promise\uff1f")),l.a.createElement("li",null,l.a.createElement(s["Link"],{to:"https://mp.weixin.qq.com/s/xa-lvWw3VT4ABN07v8RomA"},"Promise \u7ec3\u4e60\u9898")))))}));n["default"]=e=>{var n=l.a.useContext(s["context"]),r=n.demos;return l.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&s["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.a.createElement(a,{demos:r})}}}]);