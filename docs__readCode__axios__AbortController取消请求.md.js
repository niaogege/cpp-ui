(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[137],{ZhBS:function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),l=t.n(a),o=t("dEAq"),c=t("H1Ra"),r=l.a.memo((e=>{e.demos;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h2",{id:"\u53d6\u6d88\u8bf7\u6c42\u65b9\u5f0f"},l.a.createElement(o["AnchorLink"],{to:"#\u53d6\u6d88\u8bf7\u6c42\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u53d6\u6d88\u8bf7\u6c42\u65b9\u5f0f"),l.a.createElement("p",null,"\u9762\u8bd5\u5b98\uff1a\u5982\u4f55\u53d6\u6d88\u4e00\u4e2a\u5df2\u7ecf\u53d1\u51fa\u53bb\u7684 xhr?"),l.a.createElement("h3",{id:"abortcontroller-api"},l.a.createElement(o["AnchorLink"],{to:"#abortcontroller-api","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),l.a.createElement(o["Link"],{to:"https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController"},"AbortController api")),l.a.createElement("p",null,"AbortController \u63a5\u53e3\u8868\u793a\u4e00\u4e2a\u63a7\u5236\u5668\u5bf9\u8c61\uff0c\u5141\u8bb8\u4f60\u6839\u636e\u9700\u8981",l.a.createElement("strong",null,"\u4e2d\u6b62\u4e00\u4e2a\u6216\u591a\u4e2a Web")," \u8bf7\u6c42\u3002"),l.a.createElement("p",null,"\u4f60\u53ef\u4ee5\u4f7f\u7528 ",l.a.createElement("strong",null,"AbortController.abort")," \u6784\u9020\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 AbortController\u3002\u4f7f\u7528 AbortSignal \u5bf9\u8c61\u53ef\u4ee5\u5b8c\u6210\u4e0e DOM \u8bf7\u6c42\u7684\u901a\u4fe1\u3002"),l.a.createElement("p",null,"\u901a\u8fc7 AbortCtroller \u521b\u9020\u7684\u5b9e\u4f8b\uff0c\u5177\u6709\u4e24\u4e2a\u5c5e\u6027"),l.a.createElement("ul",null,l.a.createElement("li",null,"signal \u6807\u8bb0\u5728 ",l.a.createElement("em",null,"fetch/ xhr")," \u8bf7\u6c42\u4e0a\u7684\u6807\u8bb0"),l.a.createElement("li",null,"\u5b9e\u4f8b\u542b\u6709 ",l.a.createElement("strong",null,"abort()")," \u65b9\u6cd5")),l.a.createElement("p",null,"\u6211\u4eec\u5148\u4f7f\u7528 AbortController() \u6784\u9020\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u7136\u540e\u4f7f\u7528 ",l.a.createElement("strong",null,"AbortController.signal"),"\u5c5e\u6027\u83b7\u53d6\u5176\u5173\u8054 AbortSignal \u5bf9\u8c61\u7684\u5f15\u7528\u3002"),l.a.createElement("p",null,"\u5f53\u4e00\u4e2a fetch request \u521d\u59cb\u5316\uff0c\u6211\u4eec\u628a AbortSignal \u4f5c\u4e3a\u4e00\u4e2a\u9009\u9879\u4f20\u9012\u5230\u5230\u8bf7\u6c42\u5bf9\u8c61\uff08\u5982\u4e0b ","{"," signal ","}","\uff09\u3002\u8fd9\u5c06 signal \u548c controller \u4e0e\u8fd9\u4e2a fetch request \u76f8\u5173\u8054\uff0c\u7136\u540e\u5141\u8bb8\u6211\u4eec\u901a\u8fc7\u8c03\u7528 ",l.a.createElement("strong",null,"AbortController.abort()")," \u4e2d\u6b62\u8bf7\u6c42\uff0c\u5982\u4e0b\u7b2c\u4e8c\u4e2a\u4e8b\u4ef6\u76d1\u542c\u51fd\u6570\u3002"),l.a.createElement(c["a"],{code:"const controller = new AbortController();\nlet signal = controller.signal;\nconst downloadBtn = document.querySelector('.download');\nconst abortBtn = document.querySelector('.abort');\n\ndownloadBtn.addEventListener('click', fetchVideo);\n\nabortBtn.addEventListener('click', function () {\n  controller.abort();\n  console.log('Download aborted');\n});\n\nfunction fetchVideo() {\n  //...\n  fetch(url, { signal })\n    .then(function (response) {\n      //...\n    })\n    .catch(function (e) {\n      reports.textContent = 'Download error: ' + e.message;\n    });\n}",lang:"js"}),l.a.createElement("h2",{id:"axios-\u53d6\u6d88\u8bf7\u6c42\u65b9\u5f0f"},l.a.createElement(o["AnchorLink"],{to:"#axios-\u53d6\u6d88\u8bf7\u6c42\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"axios \u53d6\u6d88\u8bf7\u6c42\u65b9\u5f0f"),l.a.createElement("p",null,l.a.createElement(o["Link"],{to:"https://axios-http.com/docs/cancellation"},"Axios Cancellation")," Axios \u9002\u914d\u5668\u6709\u4e24\u79cd\uff0c\u5206\u522b\u662f\u57fa\u4e8e dom \u7684 xhr \u8bf7\u6c42\u548c node \u7aef\u539f\u751f\u7684 http \u8bf7\u6c42(node \u7aef\u7684 http.js)\uff0c\u7ec6\u770b\u4e86\u4e0b\u6d4f\u89c8\u5668\u7aef\u7684 xhr.js \u4e2d\u7684\u53d6\u6d88\u8bf7\u6c42\uff0c\u8fd9\u91cc\u9762\u6709\u7248\u672c\u533a\u522b\uff0c\u76ee\u524d\u5b98\u7f51\u4e0a\u5df2\u5efa\u8bae",l.a.createElement("strong",null,"v0.22.0"),"\u4e4b\u540e\uff0c\u91c7\u7528 AbortController \u8fd9\u79cd\u65b9\u5f0f\u53d6\u6d88 axios \u9014\u5f84\u53d1\u51fa\u7684 xhr \u8bf7\u6c42"),l.a.createElement(c["a"],{code:"// \u5b98\u7f51\u793a\u4f8b\nconst controller = new AbortController();\n\naxios\n  .get('/foo/bar', {\n    signal: controller.signal,\n  })\n  .then(function (response) {\n    //...\n  });\n// cancel the request\ncontroller.abort();",lang:"js"}),l.a.createElement("p",null,"v0.22.0 \u4e4b\u524d\u662f\u901a\u8fc7",l.a.createElement("strong",null,"CancelToken"),"\u7684\u4e24\u79cd\u65b9\u5f0f\u53d6\u6d88\uff0c\u6211\u731c\u662f\u56e0\u4e3a\u53ef\u53d6\u6d88\u7684 promises proposal \u65b9\u6848\u88ab\u64a4\u9500\u4e86"),l.a.createElement("h3",{id:"axioscanceltokensource"},l.a.createElement(o["AnchorLink"],{to:"#axioscanceltokensource","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"axios.CancelToken.source();"),l.a.createElement("p",null,"You can create a cancel token using the CancelToken.source factory as shown below:"),l.a.createElement(c["a"],{code:"const CancelToken = axios.CancelToken;\nconst source = CancelToken.source();\n\naxios\n  .get('/user/12345', {\n    cancelToken: source.token,\n  })\n  .catch(function (thrown) {\n    if (axios.isCancel(thrown)) {\n      console.log('Request canceled', thrown.message);\n    } else {\n      // handle error\n    }\n  });\naxios.post(\n  '/user/12345',\n  {\n    name: 'new name',\n  },\n  {\n    cancelToken: source.token,\n  },\n);\n// cancel the request (the message parameter is optional)\nsource.cancel('Operation canceled by the user.');",lang:"js"}),l.a.createElement("h3",{id:"\u4f20\u9012\u53ef\u6267\u884c\u51fd\u6570\u7ed9-canceltoken-\u6784\u9020\u51fd\u6570"},l.a.createElement(o["AnchorLink"],{to:"#\u4f20\u9012\u53ef\u6267\u884c\u51fd\u6570\u7ed9-canceltoken-\u6784\u9020\u51fd\u6570","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u4f20\u9012\u53ef\u6267\u884c\u51fd\u6570\u7ed9 CancelToken \u6784\u9020\u51fd\u6570"),l.a.createElement("p",null,"You can also create a cancel token by passing an executor function to the CancelToken constructor:"),l.a.createElement(c["a"],{code:"const CancelToken = axios.CancelToken;\nlet cancel;\n\naxios.get('/user/12345', {\n  cancelToken: new CancelToken(function executor(c) {\n    // An executor function receives a cancel function as a parameter\n    cancel = c;\n  }),\n});\n\n// cancel the request\ncancel();",lang:"js"}),l.a.createElement("blockquote",null,l.a.createElement("p",null,"axios \u6e90\u7801\u6bd4\u8f83\u6e05\u6670 \u53ef\u6709\u7740\u91cd\u7814\u7a76\u5b66\u5b66")),l.a.createElement("h3",{id:"canceltoken-\u662f\u5982\u4f55\u4e32\u8054\u5230-xhr-\u8bf7\u6c42\u4f7f\u4e4b\u53d6\u6d88\u8bf7\u6c42\u7684"},l.a.createElement(o["AnchorLink"],{to:"#canceltoken-\u662f\u5982\u4f55\u4e32\u8054\u5230-xhr-\u8bf7\u6c42\u4f7f\u4e4b\u53d6\u6d88\u8bf7\u6c42\u7684","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"CancelToken \u662f\u5982\u4f55\u4e32\u8054\u5230 xhr \u8bf7\u6c42\u4f7f\u4e4b\u53d6\u6d88\u8bf7\u6c42\u7684"),l.a.createElement("p",null,"\u9996\u5148\u7528\u6237\u4fa7\u9700\u8981\u4f20\u53d6\u6d88\u8bf7\u6c42\u7684\u4e00\u4e2a\u914d\u7f6e\u9879 cancelToken\uff0c\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0cCancelToken \u7c7b\u4f1a\u751f\u6210\u4e00\u4e2a cancelToken \u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u9700\u8981\u4f20\u4e00\u4e2a\u6267\u884c\u51fd\u6570\uff0c\u901a\u8fc7\u8fd9\u4e2a\u6267\u884c\u51fd\u6570\u80fd\u5f97\u5230\u5f53\u524d Promise \u4e2d\u7684 resolve,\u4e5f\u5c31\u662f\u66b4\u9732\u7ed9\u7528\u6237\u4fa7\u7684"),l.a.createElement(c["a"],{code:"cancel();",lang:"js"}),l.a.createElement("p",null,"\u53ea\u7528\u5f53\u7528\u6237\u4fa7\u624b\u52a8\u53d6\u6d88\u4e86\u8bf7\u6c42\uff0c\u624d\u4f1a\u6267\u884c\u5230 xhr \u91cc\u7684\u53d6\u6d88\u8bf7\u6c42,\u4e5f\u5c31\u662f\u5229\u7528 Promise \u7684 then \u6765\u53d6\u6d88\u7528\u6237\u4fa7\u53d1\u7684 xhr,"),l.a.createElement(c["a"],{code:"if (config && config.cancelToken) {\n  // \u53ea\u6709resolved\u7684\u65f6\u5019\u624d\u80fd\u53d6\u6d88\u8bf7\u6c42\n  // \u76f8\u5f53\u4e8enew CancelToken()\n  config.cancelToken.promise.then(function onCanceled(res) {\n    if (!xhr) return;\n    xhr.abort();\n    xhr = null;\n  });\n}",lang:"js"}),l.a.createElement("p",null,"\u6e90\u7801\u91cc\u5219\u6bd4\u8fd9\u66f4\u590d\u6742\uff0c\u56e0\u4e3a\u53ef\u80fd\u5b58\u5728\u591a\u4e2a\u53d6\u6d88\u8bf7\u6c42\uff0c\u6240\u4ee5\u5728\u6536\u96c6 cancelToken \u7684\u65f6\u5019\uff0c\u91c7\u7528\u8001\u5957\u7684\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff0c\u4ec0\u4e48\u65f6\u5019\u8ba2\u9605\uff0c\u4ec0\u4e48\u65f6\u5019\u53d1\u5e03\u5462"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u8ba2\u9605\u521d\u59cb\u5316\u7684\u65f6\u5019\u8ba2\u9605\uff0c\u4e5f\u5c31\u662f\u5728\u5f97\u5230\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u751f\u6210 CancelToken \u5b9e\u4f8b\u7684\u65f6\u5019\u8ba2\u9605")),l.a.createElement(c["a"],{code:"//  CancelToken\nCancelToken.prototype.subscribe = function subscribe(listener) {\n  if (this.reason) {\n    listener(this.reason);\n    return;\n  }\n\n  if (this._listeners) {\n    this._listeners.push(listener);\n  } else {\n    this._listeners = [listener];\n  }\n};\n// xhr.js\n\nif (config.cancelToken || config.signal) {\n  // Handle cancellation\n  // eslint-disable-next-line func-names\n  onCanceled = function (cancel) {\n    if (!request) {\n      return;\n    }\n    reject(!cancel || (cancel && cancel.type) ? new CanceledError() : cancel);\n    request.abort();\n    request = null;\n  };\n\n  config.cancelToken && config.cancelToken.subscribe(onCanceled); // \u8ba2\u9605\n\n  if (config.signal) {\n    config.signal.aborted ? onCanceled() : config.signal.addEventListener('abort', onCanceled);\n  }\n}",lang:"js"}),l.a.createElement("p",null,"\u4ec0\u4e48\u65f6\u5019\u89e6\u53d1\u8ba2\u9605\u51fd\u6570\u5462"),l.a.createElement(c["a"],{code:"function CancelToken(executor) {\n  var token = this;\n  // eslint-disable-next-line func-names\n  this.promise.then(function (cancel) {\n    if (!token._listeners) return;\n    var i;\n    var l = token._listeners.length;\n    console.log('BEFORE \u6267\u884c\u76d1\u542c\u51fd\u6570');\n    for (i = 0; i < l; i++) {\n      token._listeners[i](cancel);\n    }\n    token._listeners = null;\n  });\n}",lang:"js"}),l.a.createElement("h2",{id:"\u53c2\u8003\u6587\u6863"},l.a.createElement(o["AnchorLink"],{to:"#\u53c2\u8003\u6587\u6863","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003\u6587\u6863"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(o["Link"],{to:"https://mp.weixin.qq.com/s/vF04Kd3dCF3AiLk9dVnQow"},"Axios \u53d6\u6d88\u8bf7\u6c42\u4f60\u4f1a\uff0c\u4f46\u662f Fetch \u53d6\u6d88\u8bf7\u6c42\u4f60\u5c31\u4e0d\u4f1a\u4e86\u5427\uff1f")),l.a.createElement("li",null,l.a.createElement(o["Link"],{to:"https://mp.weixin.qq.com/s/d7fkvM2AA6ffjYfkwXLg9A"},"\u9762\u8bd5\u5b98\uff1a\u8bf7\u624b\u5199\u4e00\u4e2a\u5e26\u53d6\u6d88\u529f\u80fd\u7684\u5ef6\u8fdf\u51fd\u6570\uff0caxios \u53d6\u6d88\u529f\u80fd\u7684\u539f\u7406\u662f\u4ec0\u4e48")))))}));n["default"]=e=>{var n=l.a.useContext(o["context"]),t=n.demos;return l.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.a.createElement(r,{demos:t})}}}]);