(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[59],{3796:function(e,n,t){"use strict";t.r(n);var r=t("q1tI"),a=t.n(r),o=t("dEAq"),s=t("H1Ra"),l=a.a.memo((e=>{e.demos;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"markdown"},a.a.createElement("h3",{id:"\u6279\u91cf\u53d1\u8bf7\u6c42"},a.a.createElement(o["AnchorLink"],{to:"#\u6279\u91cf\u53d1\u8bf7\u6c42","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u6279\u91cf\u53d1\u8bf7\u6c42"),a.a.createElement(s["a"],{code:"function httpRequest(url, options) {\n  // \u771f\u5b9e\u7684\u7f51\u7edc\u8bf7\u6c42\u7701\u7565\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve(url, '11');\n    });\n  });\n}\n\nclass NetManager {\n  constructor(concurrency) {\n    this.max = concurrency;\n    this.queue = [];\n    this.len = 0;\n  }\n  request(url, data) {\n    return new Promise((resolve, reject) => {\n      this.queue.push({\n        url,\n        data,\n        resolve,\n        reject,\n      });\n      this._processNext();\n    });\n  }\n  _processNext(url, data) {\n    if (this.len >= this.max) {\n      return;\n    }\n    var obj = this.queue.shift();\n    if (obj) {\n      this.len++;\n      const p = httpRequest(url, {});\n      p.finally(() => {\n        this.len--;\n        this._processNext();\n      });\n      p.then(obj.resolve, obj.reject);\n    }\n  }\n}\nfunction queueGenerate() {\n  var res = [];\n  for (let i = 0; i < 10; i++) {\n    var pN = new Promise((resolve) => {\n      setTimeout(() => {\n        resolve(i);\n      }, 1000);\n    });\n    res.push(pN);\n  }\n  return res;\n}\nvar instance = new NetManager(3);\ninstance.request(url, {});",lang:"js"}),a.a.createElement("h3",{id:"\u5982\u4f55\u4f18\u96c5\u4e2d\u65ad-promise"},a.a.createElement(o["AnchorLink"],{to:"#\u5982\u4f55\u4f18\u96c5\u4e2d\u65ad-promise","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u4f18\u96c5\u4e2d\u65ad Promise"),a.a.createElement("ul",null,a.a.createElement("li",null,"\u4e2d\u65ad\u8c03\u7528\u94fe")),a.a.createElement(s["a"],{code:"var p1 = new Promise((resolve) => {\n  setTimeout(() => {\n    resolve(1);\n  }, 500);\n});\np1.then((res) => res)\n  .then(() => {}) // \uff1f\n  .catch(() => {\n    console.log('catch');\n  })\n  .finally((res) => {\n    console.log(res, 'finally');\n  });",lang:"js"}),a.a.createElement("p",null,"\u9762\u8bd5\u5b98\uff1a\u6539\u53d8\u4e0a\u9762\u4ee3\u7801\uff0c\u4e0d\u6253\u5370",a.a.createElement("code",null,"finally")),a.a.createElement(s["a"],{code:"var p1 = new Promise((resolve) => {\n  setTimeout(() => {\n    resolve(1);\n  }, 500);\n});\np1.then((res) => res)\n  .then(() => new Promise((resolve, reject) => {}))\n  .catch(() => {\n    console.log('catch');\n  })\n  .finally((res) => {\n    console.log(res, 'finally');\n  });",lang:"js"}),a.a.createElement("p",null,"\u5728 ",a.a.createElement("strong",null,"then \u8bed\u53e5\u91cc\u8fd4\u56de\u4e00\u4e2a\u6c38\u8fdc pending \u7684 Promise \u5373\u53ef")),a.a.createElement("ul",null,a.a.createElement("li",null,"\u4e2d\u65ad Promise")),a.a.createElement("p",null,"\u6ce8\u610f\u8fd9\u91cc\u662f\u4e2d\u65ad\u800c\u4e0d\u662f\u7ec8\u6b62\uff0c\u56e0\u4e3a Promise \u65e0\u6cd5\u7ec8\u6b62"),a.a.createElement("p",null,"\u8fd9\u4e2a\u4e2d\u65ad\u7684\u610f\u601d\u662f\uff1a\u5728\u5408\u9002\u7684\u65f6\u5019\uff0c\u628a pending \u72b6\u6001\u7684 promise \u7ed9 ",a.a.createElement("strong",null,"reject")," \u6389\u3002\u4f8b\u5982\u4e00\u4e2a\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\u5c31\u662f\u5e0c\u671b\u7ed9\u7f51\u7edc\u8bf7\u6c42\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u4e00\u65e6\u8d85\u65f6\u5c31\u5c31\u4e2d\u65ad\uff0c\u6211\u4eec\u8fd9\u91cc\u7528\u5b9a\u65f6\u5668\u6a21\u62df\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42"),a.a.createElement(s["a"],{code:"function timeWrapper(p, timeout = 2000) {\n  const wait = new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject('\u4e2d\u65ad');\n    }, timeout);\n  });\n  return Promise.race([p, wait]);\n}\n// \u968f\u673a\u6a21\u62df\u8fd4\u56de\u6570\u636e\nvar p1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('\u5f97\u5230\u670d\u52a1\u7aef\u6570\u636e');\n  }, 3000);\n});\nvar res = timeWrapper(p1, 2000);\nres\n  .then((res) => {\n    console.log(res);\n  })\n  .catch((e) => {\n    console.warn(e);\n  });",lang:"js"}),a.a.createElement("p",null,"\u5c01\u88c5\u4e0b\uff0c\u7528\u6237\u80fd\u624b\u52a8\u4e2d\u65ad\u8bf7\u6c42\uff0c\u4e3b\u8981\u662f\u8981\u66b4\u9732\u51fa\u6765\u9614\u4ee5\u4e2d\u65ad\u8bf7\u6c42\u7684 rejected"),a.a.createElement(s["a"],{code:"function abortQuest(p) {\n  var abort;\n  const wait = new Promise((resolve, reject) => {\n    abort = reject; // important\n  });\n  var res = Promise.race([p, wait]);\n  res.abort = abort;\n  return res;\n}\n// \u4f7f\u7528\n// \u968f\u673a\u6a21\u62df\u8fd4\u56de\u6570\u636e\nvar p1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('\u524d\u7aef\u5f97\u5230\u670d\u52a1\u7aef\u6570\u636e');\n  }, 3000);\n});\nvar req = abortQuest(p1);\nreq.then((e) => console.log(e, 'req res')).catch((e) => console.log(e));\nsetTimeout(() => {\n  req.abort('\u7528\u6237\u624b\u52a8\u53d6\u6d88\u8bf7\u6c42');\n}, 2000);\nconsole.log(req); // rejected",lang:"js"}),a.a.createElement("h3",{id:"promise-\u503c\u7a7f\u900f"},a.a.createElement(o["AnchorLink"],{to:"#promise-\u503c\u7a7f\u900f","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Promise \u503c\u7a7f\u900f"),a.a.createElement("p",null,"Promise.then \u6216\u8005 Promise.catch \u7684\u53c2\u6570\u671f\u671b\u662f\u51fd\u6570\uff0c\u4f20\u5165\u975e\u51fd\u6570\u5219\u4f1a\u53d1\u751f\u503c\u7a7f\u900f\u3002"),a.a.createElement(s["a"],{code:"Promise.resolve(1).then().then(2).then(22).then(Promise.resolve(3)).then(console.log);\n// 1\n\nPromise.resolve(22).then().then(Promise.reject(3)).then(console.log);\n// 22\n// Uncaught(in Promise) 3",lang:"js"}),a.a.createElement("h3",{id:"\u4e8b\u4ef6\u5faa\u73af\u4e2d\u6d89\u53ca\u5230\u7684-promise"},a.a.createElement(o["AnchorLink"],{to:"#\u4e8b\u4ef6\u5faa\u73af\u4e2d\u6d89\u53ca\u5230\u7684-promise","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u4e8b\u4ef6\u5faa\u73af\u4e2d\u6d89\u53ca\u5230\u7684 Promise"),a.a.createElement(s["a"],{code:"process.nextTick(() => {\n  console.log('nextTick');\n});\nPromise.resolve().then(() => {\n  console.log('then');\n});\nsetImmediate(() => {\n  console.log('setImmediate');\n});\nconsole.log('end');\n// console\n// end\n// nextTick\n// then\n// setImmediate",lang:"js"}),a.a.createElement("p",null,"process.nextTick \u548c promise.then \u90fd\u5c5e\u4e8e microtask\uff0c\u800c setImmediate \u5c5e\u4e8e \u5b8f\u4efb\u52a1 macrotask\uff0c\u5728\u4e8b\u4ef6\u5faa\u73af\u7684 check \u9636\u6bb5\u6267\u884c\u3002\u4e8b\u4ef6\u5faa\u73af\u7684\u6bcf\u4e2a\u9636\u6bb5\uff08macrotask\uff09\u4e4b\u95f4\u90fd\u4f1a\u6267\u884c microtask\uff0c\u4e8b\u4ef6\u5faa\u73af\u7684\u5f00\u59cb\u4f1a\u5148\u6267\u884c\u4e00\u6b21 microtask\u3002")))}));n["default"]=e=>{var n=a.a.useContext(o["context"]),t=n.demos;return a.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.a.createElement(l,{demos:t})}}}]);